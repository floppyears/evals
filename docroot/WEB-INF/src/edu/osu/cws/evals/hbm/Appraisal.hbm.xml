<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping auto-import="false" >

    <class name="edu.osu.cws.evals.models.Appraisal" table="appraisals"
           dynamic-insert="true"
           dynamic-update="true">
        <id name="id" type="int" column="ID">
            <generator class="native">
                <param name="sequence">passmgr.pass_seq</param>
            </generator>
        </id>

        <property name="startDate" type="date" column="START_DATE"/>
        <property name="endDate" type="date" column="END_DATE"/>
        <property name="goalsSubmitDate" type="timestamp" column="GOALS_SUBMIT_DATE"/>
        <property name="goalApprovedDate" type="timestamp" column="GOALS_APPROVED_DATE"/>
        <property name="goalsRequiredModificationDate" type="timestamp" column="GOALS_REQUIRED_MOD_DATE"/>
        <property name="goalsComments" type="text" column="GOALS_COMMENTS"/>
        <property name="resultSubmitDate" type="timestamp" column="RESULT_SUBMIT_DATE"/>
        <property name="evaluation" type="text" column="EVALUATION"/>
        <property name="evaluationSubmitDate" type="timestamp" column="EVALUATION_SUBMIT_DATE"/>
        <property name="rating" type="java.lang.Integer" length="1" column="RATING"/>
        <property name="reviewSubmitDate" type="timestamp" column="REVIEW_SUBMIT_DATE"/>
        <property name="review" type="text" column="REVIEW"/>
        <property name="createDate" type="timestamp" column="CREATE_DATE"/>
        <property name="rebuttal" type="text" column="REBUTTAL"/>
        <property name="rebuttalDate" type="timestamp" column="REBUTTAL_DATE"/>
        <property name="employeeSignedDate" type="timestamp" column="EMPLOYEE_SIGNED_DATE"/>
        <property name="closeOutDate" type="timestamp" column="CLOSEOUT_DATE"/>
        <property name="status" length="32" column="STATUS"/>
        <property name="reopenedDate" type="timestamp" column="REOPENED_DATE"/>
        <property name="reopenReason" type="text" column="REOPEN_REASON"/>
        <property name="originalStatus" length="32" column="ORIGINAL_STATUS"/>
        <property name="releaseDate" type="timestamp" column="RELEASE_DATE"/>
        <property name="supervisorRebuttalRead" type="timestamp" column="SUPERVISOR_REBUTTAL_READ"/>
        <property name="type" column="TYPE"/>

        <many-to-one name="job" class="edu.osu.cws.evals.models.Job" not-null="true">
            <column name="JOB_PIDM"/>
            <column name="POSITION_NUMBER"/>
            <column name="JOB_SUFFIX"/>
        </many-to-one>
        <many-to-one name="closeOutReason" class="edu.osu.cws.evals.models.CloseOutReason"
                     column="CLOSEOUT_REASON_ID"
                     not-null="false"/>
        <many-to-one name="goalsApprover" class="edu.osu.cws.evals.models.Employee"
                     column="GOALS_APPROVER_PIDM"
                     not-null="false"/>
        <many-to-one name="evaluator" class="edu.osu.cws.evals.models.Employee"
                     column="EVALUATOR_PIDM"
                     not-null="false"/>
        <many-to-one name="reviewer" class="edu.osu.cws.evals.models.Employee"
                     column="REVIEWER_PIDM"
                     not-null="false"/>
        <many-to-one name="closeOutBy" class="edu.osu.cws.evals.models.Employee"
                     column="CLOSEOUT_PIDM"
                     not-null="false"/>
        <many-to-one name="reopenedBy" class="edu.osu.cws.evals.models.Employee"
                     column="REOPENER_PIDM"
                     not-null="false"/>
        <set name="assessments" inverse="true">
            <key column="APPRAISAL_ID"/>
            <one-to-many class="edu.osu.cws.evals.models.Assessment" />
        </set>
    </class>
    <sql-query name="appraisal.reviewCount"><![CDATA[
        SELECT
            count(*)
        FROM
            appraisals
        WHERE
            STATUS in ('reviewDue' , 'reviewOverdue')
            AND JOB_PIDM =
            (SELECT PYVPASJ_PIDM from PYVPASJ
             WHERE JOB_PIDM=PYVPASJ_PIDM
             AND POSITION_NUMBER=PYVPASJ_POSN
             AND JOB_SUFFIX=PYVPASJ_SUFF
             AND PYVPASJ_BCTR_TITLE=:bcName)
    ]]></sql-query>
    <query name="appraisal.getReviews"><![CDATA[
        SELECT new edu.osu.cws.evals.models.Appraisal
            (
                id, job.jobTitle, job.positionNumber,
                startDate, endDate, type, job.employee.id, job.employee.lastName,
                job.employee.firstName, evaluationSubmitDate, status,
                job.businessCenterName, job.orgCodeDescription, job.suffix
            )
        FROM
            edu.osu.cws.evals.models.Appraisal
        WHERE
            status IN ('reviewDue', 'reviewOverdue')
            AND job.businessCenterName = :bc
    ]]></query>
    <query name="appraisal.search"><![CDATA[
        SELECT new edu.osu.cws.evals.models.Appraisal (
            id, job.jobTitle, job.positionNumber, startDate, endDate, type,
            job.employee.id, job.employee.lastName, job.employee.firstName,
            evaluationSubmitDate, status, job.businessCenterName,
            job.orgCodeDescription, job.suffix)
        FROM
            edu.osu.cws.evals.models.Appraisal
        WHERE
            job.employee.id = :pidm
    ]]></query>
    <query name="appraisal.getFirstTrialAppraisal"><![CDATA[
        from edu.osu.cws.evals.models.Appraisal
        WHERE
            job.employee.id = :pidm AND
            job.positionNumber = :posno AND
            job.suffix = :suffix
    ]]></query>
</hibernate-mapping>